{% set visaSponsorshipText %}
  {% set courseType = data[code + "-type"] %}
  {% set visaSponsorship = data[code + "-visa-sponsorship"] %}

  {% if visaSponsorship === "Yes" %}
    {% if courseType === "Salaried" %}
      You can sponsor a Skilled worker visa
    {% else %}
      You can sponsor a Student visa
    {% endif %}
  {% elseif visaSponsorship === "No" %}
    You cannot sponsor a visa
  {% else %}
    Not set
  {% endif %}
{% endset %}

{% set schoolPlacementsText %}
  {% if data[code + "-placement-policy"] == "hosted" %}
    {{ data[code + "-placement-policy-hosted"] }}
  {% elif data[code + "-placement-policy"] == "placed" %}
    {{ data[code + "-placement-policy-placed"] }}
  {% elif data[code + "-placement-policy"] == "other" %}
    {{ data[code + "-placement-policy-other"] }}
  {% else %}
    Not set
  {% endif %}
{% endset %}

{% set placementLocationsHtml %}
  {% if isArray(data[code + '-locations']) %}
    {{ data[code + '-locations'] | join('<br>') | safe }}
  {% elseif data[code + '-locations'] %}
    {{ data[code + '-locations'] }}
  {% else %}
    {{ data['schools'][0].name }}
  {% endif %}
{% endset %}

{% set applicationsOpenText %}
  {% if data[code + "-applications-open"] == "On a specific date" %}
    On {{ data[code + "-applications-open-date-day"] }}-{{ data[code + "-applications-open-date-month"] }}-{{ data[code + "-applications-open-date-year"] }}
  {% elseif data[code + "-applications-open"] == "When I publish the course" %}
    When the course is published
  {% else %}
    {{ data[code + "-applications-open"] }}
  {% endif %}
{% endset %}

{% set minimumGcsesText %}
  {% if data[code + "-no-qualifications-yet"] == "Yes (recommended)" %}
    Receive applications from candidates who haven’t gained the minimum qualifications yet
  {% else %}
    UCAS will block applications from candidates who haven’t gained the minimum qualifications yet
  {% endif %}
{% endset %}

<h3 class="govuk-heading-m">Subject</h3>
{{ govukSummaryList({
  classes: "govuk-!-margin-bottom-8",
  rows: [{
    key: {
      text: "Level"
    },
    value: {
      text: data[code + "-phase"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/phase?change=phase",
        text: "Change",
        visuallyHiddenText: "phase"
      } if isNotPublished]
    } if showChangeLinks
  },

  {
    key: {
      html: "<abbr title=\"Special educational needs and disability\">SEND</abbr>"
    },
    value: {
      text: "Yes" if data[code + "-sen"] else "No"
    },
    actions: {
      items: [{
        href: "/new/" + code + "/phase?change=phase",
        text: "Change",
        visuallyHiddenText: "SEND"
      } if isNotPublished]
    } if showChangeLinks
  },

  {
    key: {
      text: "Subject"
    },
    value: {
      html: data[code + "-subject"] + ("<br>" + data[code + "-second-subject"] if data[code + "-second-subject"])
    },
    actions: {
      items: [{
        href: "/new/" + code + "/subject?change=subject",
        text: "Change",
        visuallyHiddenText: "subject"
      }]
    } if showChangeLinks
  },

  {
    key: {
      text: "Languages"
    },
    value: {
      html: data[code + "-languages"].join("<br>") if isArray(data[code + "-languages"]) else data[code + "-languages"] | safe
    },
    actions: {
      items: [{
        href: "/new/" + code + "/languages?change=languages",
        text: "Change",
        visuallyHiddenText: "languages"
      }]
    } if showChangeLinks
  } if data[code + "-subject"] == "Modern languages",

  {
    key: {
      text: "Age range"
    },
    value: {
      text: data[code + "-age-youngest"] + " to " + data[code + "-age-oldest"] if data[code + "-age-range"] == "Another age range" else data[code + "-age-range"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/age-range?change=age-range",
        text: "Change",
        visuallyHiddenText: "age range"
      }]
    } if showChangeLinks
  }]
}) }}

<h3 class="govuk-heading-m">Outcome</h3>
{{ govukSummaryList({
  classes: "govuk-!-margin-bottom-8",
  rows: [{
    key: {
      text: "Outcome"
    },
    value: {
      text: data[code + "-outcome"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/outcome?change=outcome",
        text: "Change",
        visuallyHiddenText: "outcome"
      }]
    } if showChangeLinks
  },

  {
    key: {
      text: "Fee or salary"
    },
    value: {
      text: data[code + "-type"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/funding?change=funding",
        text: "Change",
        visuallyHiddenText: "fee or salary"
      } if isNotPublished]
    } if showChangeLinks
  } if data["new-course"]["include-fee-or-salary"] else {
    key: {
      text: "Apprenticeship"
    },
    value: {
      text: data[code + "-apprenticeship"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/apprenticeship?change=apprenticeship",
        text: "Change",
        visuallyHiddenText: "apprenticeship"
      } if isNotPublished]
    } if showChangeLinks
  },

  {
    key: {
      text: "Full or part time"
    },
    value: {
      text: data[code + "-full-part"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/full-time-part-time?change=full-time-part-time",
        text: "Change",
        visuallyHiddenText: "full time or part time"
      }]
    } if showChangeLinks
  },

  {
    key: {
      text: "Visa sponsorship"
    },
    value: {
      text: visaSponsorshipText,
      classes: "govuk-summary-list__value--empty" if not value(course.programmeCode + "-visa-sponsorship")
    },
    actions: {
      items: [{
        href: "/new/" + code + "/visa-sponsorship?change=visa-sponsorship",
        text: "Change",
        visuallyHiddenText: "visa sponsorship"
      }]
    } if showChangeLinks
  },

  {
    key: {
      text: "Accredited body"
    },
    value: {
      text: data[code + "-new-accredited-body"] or data[code + "-accredited-body"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/accredited-body?change=accredited-body",
        text: "Change",
        visuallyHiddenText: "accredited body"
      } if isNotPublished]
    } if showChangeLinks
  } if data["new-course"]["include-accredited"]]
}) }}

<h3 class="govuk-heading-m">Locations</h3>
{{ govukSummaryList({
  classes: "govuk-!-margin-bottom-8",
  rows: [{
    key: {
      text: "School placements"
    },
    value: {
      text: schoolPlacementsText,
      classes: "govuk-summary-list__value--empty" if not value(course.programmeCode + "-placement-policy")
    },
    actions: {
      items: [{
        href: "/new/" + code + "/placement-policy?change=placements",
        text: "Change",
        visuallyHiddenText: "how placements work"
      }]
    } if showChangeLinks
  },

  {
    key: {
      text: "Placement locations"
    },
    value: {
      html: placementLocationsHtml
    },
    actions: {
      items: [{
        href: "/new/" + code + "/placement-locations?change=placement-locations",
        text: "Change",
        visuallyHiddenText: "school locations"
      }]
    } if showChangeLinks
  } if data[code + "-placement-policy"] == "hosted",

  {
    key: {
      text: "Training location"
    },
    value: {
      text: data[code + "-training-location"] or "Not set",
      classes: "govuk-summary-list__value--empty" if not value(course.programmeCode + "-training-location")
    },
    actions: {
      items: [{
        href: "/new/" + code + "/training-location?change=training-location",
        text: "Change",
        visuallyHiddenText: "training location"
      }]
    } if showChangeLinks
  }]
}) }}

<h3 class="govuk-heading-m">Key dates</h3>
{{ govukSummaryList({
  classes: "govuk-!-margin-bottom-8",
  rows: [{
    key: {
      text: "Applications open"
    },
    value: {
      text: applicationsOpenText
    },
    actions: {
      items: [{
        href: "/new/" + code + "/applications-open?change=applications-open",
        text: "Change",
        visuallyHiddenText: "applications open date"
      } if isNotPublished]
    } if showChangeLinks
  },

  {
    key: {
      text: "Course starts"
    },
    value: {
      text: data[code + "-start-date"]
    },
    actions: {
      items: [{
        href: "/new/" + code + "/start-date?change=start-date",
        text: "Change",
        visuallyHiddenText: "start date"
      } if isNotPublished]
    } if showChangeLinks
  }]
}) }}
