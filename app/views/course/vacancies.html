{% extends "layout.html" %}
{% set title = 'Edit vacancies' %}
{% block page_title %}{{ title }}{% endblock %}
{% set coursePath = '/course/' + data['provider-code'] + '/' + course.programmeCode %}
{% block content %}

<main id="content" role="main">
  {% include "includes/phase_banner_beta.html" %}
  <a href="/" class="link-back">Back</a>

  <h1 class="heading-xlarge">
    <span class="heading-secondary">{{ course.name | safe }} ({{ course.programmeCode }})</span>
    {{ title }}
  </h1>

  {% include "course/_errors.html" %}

  <div class="grid-row">
    <div class="column-two-thirds">
      <form action="{{ coursePath }}/vacancies" method="post">

        {% if data[course.programmeCode + '-multi-location'] %}
          {% set fields = [
              {
                name: 'Vacancies'
              }
            ]
          %}

          {% set table %}
            <div class="add-double-bottom-margin">
              <table>
                <thead>
                  <tr>
                    <th>Training locations with vacancies</th>
                  </tr>
                </thead>
                <tbody>
                  {% for s in course.schools %}
                    <tr>
                      <td>
                        <div class="multiple-choice">
                          <input
                            id="checkbox-part-{{ loop.index }}"
                            type="checkbox"
                            name="{{ course.programmeCode + '-vacancies-' + loop.index }}"
                            value="Vacancies"
                            {{ checked(course.programmeCode + '-vacancies-' + loop.index, 'Vacancies') }}
                          >
                          <label for="checkbox-part-{{ loop.index }}">
                            {{ s.name }}
                          </label>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endset %}

          {% set radioFields = [
              {
                name: 'There are no vacancies',
                text: 'Close this course to new applications.<br />You can reopen a course later.'
              },
              {
                or: true
              },
              {
                name: 'There are some vacancies',
                text: 'Pick the locations with vacancies',
                more: table
              }
            ]
          %}

          {{ macros.radioGroup(course.programmeCode + '-vacancies-choice', radioFields) }}
        {% else %}
          {% if data[course.programmeCode + '-vacancies-flag'] == 'Yes' %}
            {% set fields = [
                {
                  name: 'There are no vacancies',
                  text: 'Close this course to new applications.<br />You can reopen a course later.'
                }
              ]
            %}
          {% else %}
            {% set fields = [
                {
                  name: 'There are vacancies',
                  text: 'Reopen this course to new applications.'
                }
              ]
            %}
          {% endif %}

          <input type="hidden" name="{{ course.programmeCode }}-vacancies-flag" value="{% if data[course.programmeCode + '-vacancies-flag'] == 'Yes' %}No{% else %}Yes{% endif %}" />
          {{ macros.checkboxGroup(course.programmeCode + '-vacancies', fields, errors) }}
        {% endif %}

        <div class="add-double-bottom-margin">
          <input type="submit" class="button" value="Publish changes" />
        </div>

        <p>
          <a href="/course/{{ data['provider-code'] }}/{{ course.programmeCode }}">Cancel changes</a>
        </p>

        <p>There may be a delay before your changes appear on UCAS Apply.</p>
      </form>
    </div>
  </div>
</main>

{% endblock %}
