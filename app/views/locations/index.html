{% extends "layout.html" %}
{% set title = "Locations" %}

{% block pageNavigation %}
  {{ govukBreadcrumbs({
    items: breadcrumbItems({
      text: "Locations"
    })
  }) }}
{% endblock %}

{% macro locationsTable(locations, caption) %}
  <div class="govuk-!-margin-top-8">
  {% if locations.length > 0 %}
    <table class="govuk-table">
      {% if caption %}
        <caption class="govuk-table__caption govuk-table__caption--m">{{ caption }}</caption>
      {% endif %}
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header" scope="col" width="5%">URN</th>
          <th class="govuk-table__header" scope="col" width="40%">Name</th>
          <th class="govuk-table__header" scope="col" width="60%">Address</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for location in locations %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">{{ location.urn }}</td>
          <td class="govuk-table__header"><a href="/location/{{ location.code }}">{{ location.name }}</a></td>
          <td class="govuk-table__cell">{{ location.address }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <h2 class="govuk-heading-m">{{ caption }}</h2>
    <p class="govuk-body">No {{ caption | lower }} added.</p>
  {% endif %}
  </div>
{% endmacro %}

{% block content %}
  {% set justCreatedHtml %}
    <h3 class="govuk-notification-banner__heading">Your location has been added.</h3>
    <p class="govuk-body">Before candidates can pick this location, you must assign it to one or more courses. You can do this when adding or editing courses.</p>
  {% endset %}
  {{ govukNotificationBanner({
    html: justCreatedHtml,
    type: "success"
  }) if justCreated }}

  {{ govukNotificationBanner({
    text: "Your changes have been published.",
    type: "success"
  }) if justEdited }}

  {{ govukNotificationBanner({
    text: "16 new locations added.",
    type: "success"
  }) if justUploaded }}

  <h1 class="govuk-heading-xl">
    {% if data['next-cycle'] %}<span class="govuk-caption-xl">Next cycle (2022 to  2023)</span>{% endif %}
    {{ title }}
  </h1>

  <div class="govuk-!-width-two-thirds">
    <p class="govuk-body">Locations are used to help rank search results on Find.</p>
    <p class="govuk-body">For courses where candidates can choose a lead or host school, you can also assign locations from the ‘Basic details’ tab on the course page.</p>
  </div>

  {% set buttonHtml %}
    <div class="govuk-button-group">
      {{ govukButton({
        text: "Add a new location",
        href: "/location/start"
      }) }}

      <a class="govuk-link govuk-link--no-visited-state" href="/location/upload">Upload location data</a>
    </div>
  {% endset %}

  {{ buttonHtml | safe }}

  {{ locationsTable(locations | rejectattr("placement"), "Academic training locations") }}
  {{ locationsTable(locations | selectattr("placement"), "Placement schools") }}

  {{ buttonHtml | safe if locations.length > 10 }}
{% endblock %}
